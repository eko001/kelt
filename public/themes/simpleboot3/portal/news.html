<!DOCTYPE html>
<html>
<head>
    <include file="public@head"/>
</head>
<body>
<div id="news" class="news">
    <div class="banner">
        <div class="news_banner_text">了解最新的资讯与动态</div>
    </div>
    <div class="typelist">
        <ul class="type">
            <volist name="typeList" id="vo">
                <li data-url="{$vo.id}">{$vo.name}</li>
            </volist>
        </ul>
    </div>
	<div id="newsList"></div>
	
	<div class="pageLimitbox">
	    <ul class="pagination"> <span class="pageSpan"></span></ul>
	    <ul id="pageLimit" class="pagination pagination-lg"></ul>
	</div>
</div>
<include file="public@footer"/>
</body>
<script src="__TMPL__/public/assets/style/js/bootstrap-paginator.js"></script>
<script type="text/javascript">
    $(function () {
        let typeList =  <?php echo $typeList; ?> ;
		if(typeList.length>0){
			let firstId= typeList[0].id;
			$.ajax({
			    type: "post",
			    url: "{:url('App/getNewsList')}" ,
			    data: {category:firstId},
			    dataType: "json",
			    success: function (result) {
			        console.log(result);//打印服务端返回的数据(调试用)
			        if (result.code == 1) {
						console.log(result.data);	
			            var arr = result.data.list.data;
			            if(arr.length!=0){
			                var html = "";
			                html += '<div class="list">';
			                for(var i = 0;i<arr.length;i++){
			                    html += '<div class="item" data-id="'+ arr[i].id + '" data-cid="'+ arr[i].category_id + '">';
			                    html += '<img src="' + arr[i].thumbnail +'" alt="">';
			                    html += '<div class="title">'+ arr[i].post_title + '</div>'
			                    html += '<div class="content">'+ arr[i].post_content + '</div>';
			                    // html += '</a>';
			                    html += '</div>';
			                }
			                html += '</div>';
			                $("#newsList").html(html);
			            }else{
							$("#newsList").html('');
						}
						if(result.data.page!=null){
							$(".pageSpan").html(result.data.page);
						}else{
							$(".pageSpan").html('');
						}
			        }
			    },
			    error : function() {
			        alert("该文章未发布！");
			    }
			})
		}
		console.log(typeList);
        $(".typelist ul li").removeClass("active");
		$(".typelist ul li").eq(0).addClass("active");
		$(".typelist ul li").on("click",function(){
			$(".typelist ul li").removeClass("active");
			$(this).addClass("active");
			var category = $(this).attr("data-url");
			console.log(category);
			$.ajax({
			    type: "post",
			    url: "{:url('App/getNewsList')}" ,
			    data: {category},
			    dataType: "json",
			    success: function (result) {
			        console.log(result);//打印服务端返回的数据(调试用)
			        if (result.code == 1) {
						console.log(result.data);	
			            var arr = result.data.list.data;
                        if(arr.length!=0){
                            var html = "";
                            html += '<div class="list">';
                            for(var i = 0;i<arr.length;i++){
                                html += '<div class="item" data-id="'+ arr[i].id + '" data-cid="'+ arr[i].category_id + '">';
                                html += '<img src="' + arr[i].thumbnail +'" alt="">';
                                html += '<div class="title">'+ arr[i].post_title + '</div>'
                                html += '<div class="content">'+ arr[i].post_content + '</div>';
                                // html += '</a>';
                                html += '</div>';
                            }
                            html += '</div>';
                            $("#newsList").html(html);
                        }else{
							$("#newsList").html('');
						}
						if(result.data.page!=null){
							$(".pageSpan").html(result.data.page);
						}else{
							$(".pageSpan").html('');
						}
			        }
			    },
			    error : function() {
			        alert("该文章未发布！");
			    }
			})
		})
		$("#newsList").on("click",".item",function(){
			var id = $(this).attr("data-id");
			var cid = $(this).attr("data-cid");
			var location = window.location.href;
			console.log(location);
			var newLocation= location.substring(0, location.length-10);
			window.open(newLocation+'detail.html?id='+id+"&cid="+cid)
		})
    })
</script>
</body>
</html>